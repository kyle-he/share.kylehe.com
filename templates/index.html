<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>share.kylehe.com</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Socket.IO Client -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>share.kylehe.com</h1>

        <!-- Drag and Drop Zone -->
        <div id="dropZone" class="drop-zone">
            Drag & Drop files here or paste files
        </div>

        <!-- File Upload Form -->
        <form
            id="uploadForm"
            method="post"
            enctype="multipart/form-data"
            class="file-upload-form"
        >
            <input type="file" name="file" id="fileInput" multiple webkitdirectory directory required />
            <input type="submit" value="Upload" class="submit-button" />
        </form>

        <!-- Selected Files Display -->
        <div id="selectedFiles" class="selected-files"></div>

        <!-- Uploading Indicator -->
        <div id="uploading" class="uploading" style="display: none;">
            Uploading...
        </div>

        <!-- Progress Bar -->
        <progress id="progressBar" value="0" max="100" style="display: none;"></progress>

        <!-- Estimated Time Left -->
        <div id="timeLeft" class="time-left" style="display: none;">
            Estimated time left: <span id="time"></span>
        </div>

        <!-- Torrenting Section -->
        <div class="torrent-section">
            <h2>Torrent Magnet</h2>
            <form id="torrentForm" class="file-upload-form">
                <input type="text" id="magnetInput" placeholder="Enter Magnet URI" required />
                <input type="submit" value="Start Torrent" class="submit-button" />
            </form>

            <button id="cancelTorrent" class="submit-button" style="display: none;">
                Cancel Torrent
            </button>

            <progress id="torrentProgress" value="0" max="100" style="display: none;"></progress>
            <div id="downloadInfo" class="download-info" style="display: none;">
                <p><strong>Downloaded:</strong> <span id="dataDownloaded">0 MB</span> / <span id="totalSize">0 MB</span></p>
                <p><strong>Speed:</strong> <span id="downloadSpeed">0 KB/s</span></p>
                <p><strong>Torrent:</strong> <span id="torrentName">N/A</span></p>
            </div>
        </div>

        <!-- Storage Information -->
        <h2>Storage Information</h2>
        <p>Total storage: {{ total_storage | filesizeformat }}</p>
        <p>Used storage: {{ used_storage | filesizeformat }}</p>
        <p>Available storage: {{ free_storage | filesizeformat }}</p>

        <!-- File List -->
        <h2>Files</h2>
        <ul id="fileList">
            {% for file, size, is_dir in file_info %}
            <li>
                <div class="fileText">
                    <a href="{{ url_for('uploaded_file', filename=file) }}" class="filename">{{ file }}</a>
                    ({{ 'directory' if is_dir else (size / (1024*1024) | round(2)) ~ ' MB' }})
                </div>
                <form method="post" action="{{ url_for('delete_file', filename=file) }}">
                    <input type="submit" class="submit-button delete-button" value="Delete" />
                </form>
            </li>
            {% endfor %}
        </ul>
    </div>

    <!-- Include custom script -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
